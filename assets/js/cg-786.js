(window.webpackJsonp=window.webpackJsonp||[]).push([[786],{1087:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"《分布式im系统》大后端平台-好友服务-第04节-异步更新好友微服务数据的设计和实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#《分布式im系统》大后端平台-好友服务-第04节-异步更新好友微服务数据的设计和实现"}},[t._v("#")]),t._v(" 《分布式IM系统》大后端平台-好友服务-第04节：异步更新好友微服务数据的设计和实现")]),t._v(" "),s("p",[t._v("作者：冰河\n"),s("br"),t._v("星球："),s("a",{attrs:{href:"http://m6z.cn/6aeFbs",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://m6z.cn/6aeFbs"),s("OutboundLink")],1),t._v(" "),s("br"),t._v("博客："),s("a",{attrs:{href:"https://binghe.gitcode.host",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://binghe.gitcode.host"),s("OutboundLink")],1),t._v(" "),s("br"),t._v("文章汇总："),s("a",{attrs:{href:"https://binghe.gitcode.host/md/all/all.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://binghe.gitcode.host/md/all/all.html"),s("OutboundLink")],1),t._v(" "),s("br"),t._v("源码获取地址："),s("a",{attrs:{href:"https://t.zsxq.com/0dhvFs5oR",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://t.zsxq.com/0dhvFs5oR"),s("OutboundLink")],1),t._v(" "),s("br"),t._v("课程视频："),s("a",{attrs:{href:"https://t.zsxq.com/17Fv1jt5q",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://t.zsxq.com/17Fv1jt5q"),s("OutboundLink")],1)]),t._v(" "),s("blockquote",[s("p",[t._v("沉淀，成长，突破，帮助他人，成就自我。")])]),t._v(" "),s("ul",[s("li",[t._v("本节难度：★★☆☆☆")]),t._v(" "),s("li",[t._v("本节重点：更新用户基本信息时异步更新好友微服务相关的数据，掌握跨微服务的异步处理事件的落地方案与实现技巧，掌握在DDD领域架构模式下，不同微服务之间的数据异步交互方案，并能够将其灵活应用到自身实际项目中。")]),t._v(" "),s("li",[t._v("课程视频："),s("a",{attrs:{href:"https://t.zsxq.com/17Fv1jt5q",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://t.zsxq.com/17Fv1jt5q"),s("OutboundLink")],1)])]),t._v(" "),s("p",[s("strong",[t._v("大家好，我是冰河~~")])]),t._v(" "),s("p",[t._v("在分布式IM即时通讯系统中，有这样一种场景：用户在更新自己的基本信息时，例如修改了自己的昵称和头像，需要更新好友关系中关于自己的昵称和头像，并且用户微服务和还有微服务是两个不同的微服务，也就是运行在JVM中的两个不同的服务实例，那如何实现用户更新基本信息时，一起更新好友关系中的信息呢？")]),t._v(" "),s("h2",{attrs:{id:"一、前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、前言"}},[t._v("#")]),t._v(" 一、前言")]),t._v(" "),s("p",[t._v("其实，了解过分布式事务，或者学习过《"),s("a",{attrs:{href:"https://articles.zsxq.com/id_nv9b1dwaufpt.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("分布式Seckill秒杀系统"),s("OutboundLink")],1),t._v("》的小伙伴都知道，一个微服务在更新数据时，需要同步更新另一个微服务的数据，这是一种典型的分布式事务问题。但是，我们结合分布式IM即时通讯系统的场景进行思考，真的有必要一定保证用户微服务的数据和好友关系数据的强一致吗？其实，用户微服务的数据更新后，没必要保证用户微服务的数据和好友微服务的数据强一致，这种场景下，可以允许最终一致。")]),t._v(" "),s("h2",{attrs:{id:"二、本节诉求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、本节诉求"}},[t._v("#")]),t._v(" 二、本节诉求")]),t._v(" "),s("p",[t._v("实现更新用户基本信息数据时，异步更新好友微服务相关的数据，掌握跨微服务的异步处理事件的落地方案与实现技巧，掌握在DDD领域架构模式下，不同微服务之间的数据异步交互方案，并能够将其灵活应用到自身实际项目中。")]),t._v(" "),s("h2",{attrs:{id:"三、流程设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、流程设计"}},[t._v("#")]),t._v(" 三、流程设计")]),t._v(" "),s("p",[t._v("当用户微服务更新数据时，异步更新好友微服务的流程如图4-1所示。")]),t._v(" "),s("div",{attrs:{align:"center"}},[s("img",{attrs:{src:"https://binghe.gitcode.host/images/project/im/2024-01-16-001.png?raw=true",width:"70%"}}),t._v(" "),s("br")]),t._v(" "),s("p",[t._v("可以看到，整个流程本质上就是生产者和消费者模式，用户微服务作为生产者，当用户微服务更新完自身数据后，会发送更新事件到分布式消息中间件。而好友微服务作为消费者，监听分布式消息中间件中的数据，当接收到数据时，就会更新自身服务的数据。并且数据在用户微服务和好友微服务之间交互时，会以统一的事件模型进行交互。")]),t._v(" "),s("h2",{attrs:{id:"四、编码实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、编码实现"}},[t._v("#")]),t._v(" 四、编码实现")]),t._v(" "),s("p",[t._v("编码实现的过程中，我们可以分成实现事件模型、实现消息生产者和实现消息消费者三个方面进行讲解。")]),t._v(" "),s("h3",{attrs:{id:"_4-1-实现事件模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-实现事件模型"}},[t._v("#")]),t._v(" 4.1 实现事件模型")]),t._v(" "),s("p",[t._v("User2FriendEvent类表示用户微服务向分布式消息中间件投递数据的基础事件模型类，用户微服务向消息中间件投递消息，还有微服务订阅接收消息中间件中的数据，都是以User2FriendEvent类的对象进行交互。")]),t._v(" "),s("p",[t._v("源码详见：bh-im-platform-common工程下的io.binghe.im.platform.common.model.event.User2FriendEvent。")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User2FriendEvent")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IMBaseEvent")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//昵称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" nickName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//头像")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" headImg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User2FriendEvent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User2FriendEvent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" nickName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" headImg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" destination"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" destination"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nickName "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nickName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headImg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" headImg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*******************省略其他代码*****************/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br")])]),s("h2",{attrs:{id:"查看完整文章"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看完整文章"}},[t._v("#")]),t._v(" 查看完整文章")]),t._v(" "),s("p",[t._v("加入"),s("a",{attrs:{href:"https://public.zsxq.com/groups/48848484411888.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("冰河技术"),s("OutboundLink")],1),t._v("知识星球，解锁完整技术文章与完整代码")])])}),[],!1,null,null,null);s.default=e.exports}}]);