(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{392:function(t,r,e){"use strict";e.r(r);var _=e(7),a=Object(_.a)({},(function(){var t=this,r=t._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"《并发设计模式》第22章-承诺模式-基于承诺模式优化文件同步助手项目"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#《并发设计模式》第22章-承诺模式-基于承诺模式优化文件同步助手项目"}},[t._v("#")]),t._v(" 《并发设计模式》第22章-承诺模式-基于承诺模式优化文件同步助手项目")]),t._v(" "),r("p",[t._v("作者：冰河\n"),r("br"),t._v("星球："),r("a",{attrs:{href:"http://m6z.cn/6aeFbs",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://m6z.cn/6aeFbs"),r("OutboundLink")],1),t._v(" "),r("br"),t._v("博客："),r("a",{attrs:{href:"https://binghe.gitcode.host",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://binghe.gitcode.host"),r("OutboundLink")],1),t._v(" "),r("br"),t._v("文章汇总："),r("a",{attrs:{href:"https://binghe.gitcode.host/md/all/all.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://binghe.gitcode.host/md/all/all.html"),r("OutboundLink")],1),t._v(" "),r("br"),t._v("源码获取地址："),r("a",{attrs:{href:"https://t.zsxq.com/0dhvFs5oR",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://t.zsxq.com/0dhvFs5oR"),r("OutboundLink")],1)]),t._v(" "),r("blockquote",[r("p",[t._v("沉淀，成长，突破，帮助他人，成就自我。")])]),t._v(" "),r("ul",[r("li",[t._v("本章难度：★★☆☆☆")]),t._v(" "),r("li",[t._v("本章重点：了解承诺模式在文件助手项目中的应用，掌握基于承诺模式优化项目的方法和技巧，进一步重点掌握承诺模式在实际项目场景中的应用，并能够结合自身项目实际场景思考如何将承诺模式灵活应用到自身实际项目中。")])]),t._v(" "),r("p",[r("strong",[t._v("大家好，我是冰河~~")])]),t._v(" "),r("p",[t._v("实际项目中，有很多业务场景都可以使用承诺模式进行优化。总体来说，承诺模式本质上还是多个线程并行执行项目， 当项目中存在多个关联性不强的业务，哪怕多个关联性不强的业务之间存在一定的关联性，比如业务A和业务B，业务A虽然和业务B在主体逻辑的执行上关联性不大，但是业务A的执行需要业务B的执行结果，此时，都可以使用承诺模式实现。")]),t._v(" "),r("h2",{attrs:{id:"一、用户故事"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一、用户故事"}},[t._v("#")]),t._v(" 一、用户故事")]),t._v(" "),r("p",[t._v("小菜在开发文件同步助手项目时，毫无疑问又遇到性能问题了。虽说老王给小菜讲清楚了承诺模式及其使用场景，也基于承诺模式优化了社区电商项目，但是小菜本质上还是没彻底掌握承诺模式在实际项目中的应用。这不，就在开发文件同步助手项目时，又遇到性能问题了。在老王的耐心讲解下，小菜明白了文件助手项目性能很差的主要原因，也知晓了可以使用承诺模式来优化文件同步助手项目。")]),t._v(" "),r("p",[t._v("但是，说归说，真正要优化的时候，小菜却又无从下手了，到底该怎么优化，此时的小菜还是挺懵的，尽管对比了社区电商基于承诺模式优化的代码，可还是有点力不从心，眼看就要下班了，小菜觉得干脆还是问老王算了。")]),t._v(" "),r("h2",{attrs:{id:"二、求助老王"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二、求助老王"}},[t._v("#")]),t._v(" 二、求助老王")]),t._v(" "),r("p",[t._v("小菜走到老王身边说：“老大，我现在知道要使用承诺模式优化文件同步助手项目，但是还是不知道具体怎么去优化，可以给我讲讲吗？”。")]),t._v(" "),r("p",[t._v("老王抬头看了小菜一眼，说道：“嗯，看来你还是没彻底掌握承诺模式在实际项目中的应用啊，这样吧，我结合文件助手项目再给你讲讲吧”。")]),t._v(" "),r("p",[t._v("“好的，谢谢老大”。")]),t._v(" "),r("p",[t._v("“我们还是去会议室吧”。")]),t._v(" "),r("p",[t._v("“好的”。")]),t._v(" "),r("p",[t._v("于是，二人拿着电脑再次走进了会议室。")]),t._v(" "),r("h2",{attrs:{id:"三、问题重现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#三、问题重现"}},[t._v("#")]),t._v(" 三、问题重现")]),t._v(" "),r("p",[t._v("“在正式讲如何使用承诺模式优化文件同步助手项目之前，我们再来明确下文件助手的需求”，老王说到。")]),t._v(" "),r("p",[t._v("文件同步助手的需求主要是：将服务器上存储的图片同步到云端，比如将本地服务器上存储的图片同步到阿里云或者腾讯云。具体的逻辑就是：文件同步助手项目会监听本地服务器的目录，一旦目录中发生变化，就会将变化的文件同步到阿里云或者腾讯云，在监听的过程中，为了避免同步的文件有误，还会启动扫描任务，定时扫描本地目录的文件，对比变化的文件，将文件同步到阿里云或者腾讯云。")]),t._v(" "),r("p",[t._v("在业务逻辑上可以将文件助手总体划分成三部分：与远程服务器建立连接、监听或扫描本地文件、同步文件到远程服务器。在小菜实现的代码中，这三部分是串行执行的，每一部分的执行都是比较耗时的，同步文件到远程服务器的任务需要等到与远程服务器建立连接的任务和扫描本地文件的任务执行完毕后再执行，如图22-1所示。")]),t._v(" "),r("div",{attrs:{align:"center"}},[r("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/concurrent/2023-10-08-002.png?raw=true",width:"80%"}}),t._v(" "),r("br")]),t._v(" "),r("p",[t._v("可以看到，如果连接远程服务器的任务和监听或者扫描本地文件的任务执行非常慢，在这种串行执行任务的模式下，要经过较长的时间才能开始同步文件到远程服务器，性能是非常差的。")]),t._v(" "),r("p",[t._v("“这个我们之前已经分析过了，这里确认可以听懂吧？”，老王问小菜。")]),t._v(" "),r("p",[t._v("“可以听懂”，小菜回应到。")]),t._v(" "),r("p",[t._v("“好，那我们继续吧”。")]),t._v(" "),r("h2",{attrs:{id:"四、优化策略"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#四、优化策略"}},[t._v("#")]),t._v(" 四、优化策略")]),t._v(" "),r("p",[t._v("既然串行执行文件助手的三部分业务逻辑性能很差，那我们可以想办法将其并行化。这里，我们可以分析下，对于与远程服务器建立连接、监听或扫描本地文件、同步文件到远程服务器，这三部分业务逻辑来说，与远程服务器建立连接和监听或扫描本地文件执行完毕后，才能开始同步远程服务器，并且在业务逻辑上，与远程服务器建立连接和监听或扫描本地文件关联并不大，这两部分可以实现并行执行，整体如图22-2所示。")]),t._v(" "),r("h2",{attrs:{id:"查看全文"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#查看全文"}},[t._v("#")]),t._v(" 查看全文")]),t._v(" "),r("p",[t._v("加入"),r("a",{attrs:{href:"http://m6z.cn/6aeFbs",target:"_blank",rel:"noopener noreferrer"}},[t._v("冰河技术"),r("OutboundLink")],1),t._v("知识星球，解锁完整技术文章与完整代码")])])}),[],!1,null,null,null);r.default=a.exports}}]);