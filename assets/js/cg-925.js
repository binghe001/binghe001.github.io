(window.webpackJsonp=window.webpackJsonp||[]).push([[925],{1225:function(a,t,s){"use strict";s.r(t);var e=s(7),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"《seckill秒杀系统》第87章-业务网关整合nacos配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#《seckill秒杀系统》第87章-业务网关整合nacos配置"}},[a._v("#")]),a._v(" 《Seckill秒杀系统》第87章：业务网关整合Nacos配置")]),a._v(" "),t("p",[a._v("作者：冰河\n"),t("br"),a._v("星球："),t("a",{attrs:{href:"http://m6z.cn/6aeFbs",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://m6z.cn/6aeFbs"),t("OutboundLink")],1),a._v(" "),t("br"),a._v("博客："),t("a",{attrs:{href:"https://binghe.gitcode.host",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://binghe.gitcode.host"),t("OutboundLink")],1),a._v(" "),t("br"),a._v("文章汇总："),t("a",{attrs:{href:"https://binghe.gitcode.host/md/all/all.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://binghe.gitcode.host/md/all/all.html"),t("OutboundLink")],1),a._v(" "),t("br"),a._v("源码获取地址："),t("a",{attrs:{href:"https://t.zsxq.com/0dhvFs5oR",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://t.zsxq.com/0dhvFs5oR"),t("OutboundLink")],1)]),a._v(" "),t("blockquote",[t("p",[a._v("沉淀，成长，突破，帮助他人，成就自我。")])]),a._v(" "),t("ul",[t("li",[a._v("本章难度：★★☆☆☆")]),a._v(" "),t("li",[a._v("本章重点：掌握网关整合Nacos的配置流程，重点理解Nacos简化项目的配置原理，并且掌握基础Nacos的服务注册与发现流程，并能够将其灵活应用到自身实际项目中。")])]),a._v(" "),t("p",[t("strong",[a._v("大家好，我是冰河~~")])]),a._v(" "),t("p",[a._v("整合业务网关之后，客服端请求微服务时，就可以通过业务网关来统一转发请求了，也就是可以通过业务网关进行路由，将请求路由到正确的微服务上。并且后续可以在业务网关中实现鉴权、流控和风控等等一系列的功能。")]),a._v(" "),t("h2",{attrs:{id:"一、前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、前言"}},[a._v("#")]),a._v(" 一、前言")]),a._v(" "),t("p",[a._v("引入业务网关后，我们的秒杀系统就有了更进一步的保证，后续我们也会在业务网管层实现流控等功能。但是，现在有个问题就是：引入网关后，在配置文件中配置了增加对应微服务的路由地址，目前这个地址还是直接写死的，如果新增了微服务，我们还需要手动加到网关中。难道引入网关就这么low吗？")]),a._v(" "),t("p",[a._v("事实是不可能这么low的，我们要实现服务自动注册与发现，当有新的微服务启动后，网关可以自动感知到，并且可以按照一定的负载均衡策略进行分发。这就需要将网关整合到Nacos。好了，说干就干，开始吧。")]),a._v(" "),t("h2",{attrs:{id:"二、本章诉求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、本章诉求"}},[a._v("#")]),a._v(" 二、本章诉求")]),a._v(" "),t("p",[a._v("对网关与Nacos进行初步整合，从Nacos中获取转发的服务地址，并对其进行测试。随后，实现网关与Nacos的最简化配置，达到网关无需配置任何微服务信息，即可动态从Nacos获取转发的服务地址。重点掌握网关与Nacos的整合流程，并能够熟练应用到自身实际项目中。")]),a._v(" "),t("h2",{attrs:{id:"三、网关初步整合nacos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、网关初步整合nacos"}},[a._v("#")]),a._v(" 三、网关初步整合Nacos")]),a._v(" "),t("p",[a._v("在前面的文章中，初步整合SpringCloud Gateway中，我们在服务网关模块的application.yml文件中硬编码配置了服务转发的地址，如下所示。")]),a._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[0].id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("user-gateway")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[0].uri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("http://localhost:8081")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[0].order")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[0].predicates[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Path=/seckill-user/**")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[0].filters[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("StripPrefix=1")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[1].id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("activity-gateway")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[1].uri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("http://localhost:8082")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[1].order")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[1].predicates[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Path=/seckill-activity/**")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[1].filters[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("StripPrefix=1")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[2].id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("goods-gateway")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[2].uri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("http://localhost:8083")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[2].order")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[2].predicates[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Path=/seckill-goods/**")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[2].filters[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("StripPrefix=1")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[3].id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("order-gateway")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[3].uri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("http://localhost:8084")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[3].order")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[3].predicates[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Path=/seckill-order/**")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[3].filters[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("StripPrefix=1")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[4].id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("stock-gateway")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[4].uri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("http://localhost:8085")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[4].order")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[4].predicates[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Path=/seckill-stock/**")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[4].filters[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("StripPrefix=1")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[5].id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("reservation-gateway")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[5].uri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("http://localhost:8086")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[5].order")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[5].predicates[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Path=/seckill-reservation/**")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("spring.cloud.gateway.routes[5].filters[0]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("StripPrefix=1")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br"),t("span",{staticClass:"line-number"},[a._v("35")]),t("br")])]),t("p",[a._v("这里，我们需要将网关与Nacos进行整合，实现从Nacos注册中心获取转发的服务地址，具体实现步骤如下所示。")]),a._v(" "),t("p",[t("strong",[a._v("（1）引入依赖")])]),a._v(" "),t("p",[a._v("在seckill-gateway工程下的pom.xml文件中引入loadbalancer依赖。")]),a._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.springframework.cloud"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-loadbalancer"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[t("strong",[a._v("（2）修改配置文件")])]),a._v(" "),t("p",[a._v("将application.yml备份一份，命名为application-simple.yml，并修改application.yml配置文件，修改后的文件如下所示。")]),a._v(" "),t("h2",{attrs:{id:"查看完整文章"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看完整文章"}},[a._v("#")]),a._v(" 查看完整文章")]),a._v(" "),t("p",[a._v("加入"),t("a",{attrs:{href:"http://m6z.cn/6aeFbs",target:"_blank",rel:"noopener noreferrer"}},[a._v("冰河技术"),t("OutboundLink")],1),a._v("知识星球，解锁完整技术文章与完整代码")])])}),[],!1,null,null,null);t.default=n.exports}}]);