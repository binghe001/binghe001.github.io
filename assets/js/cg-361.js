(window.webpackJsonp=window.webpackJsonp||[]).push([[361],{653:function(t,a,r){"use strict";r.r(a);var s=r(7),e=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"《面试必问》第06章-聊聊kafka的消费模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#《面试必问》第06章-聊聊kafka的消费模型"}},[t._v("#")]),t._v(" 《面试必问》第06章：聊聊Kafka的消费模型？")]),t._v(" "),a("p",[a("strong",[t._v("大家好，我是冰河~~")])]),t._v(" "),a("p",[t._v("最近，有些读者去头条二面，被面试官问了一个关于Kafka的问题："),a("strong",[t._v("多个Kafka消费者如何同时消费相同Topic下的相同Partition的数据？")]),t._v(" 看似一个简单的问题，竟然把这位读者问懵了！")]),t._v(" "),a("p",[t._v("今天，我们就一起来说说这个面试题，好了，开始今天的主题。")]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"图片","data-src":"https://img-blog.csdnimg.cn/img_convert/b1c2ff67a17e80f250720fc29f189a42.png",loading:"lazy"}})]),t._v(" "),a("h2",{attrs:{id:"题目分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#题目分析"}},[t._v("#")]),t._v(" 题目分析")]),t._v(" "),a("p",[t._v("首先，要明确面试官的问题："),a("strong",[t._v("多个Kafka消费者如何同时消费相同Topic下的相同Partition的数据？")]),t._v(" 这个问题问的已经很明显了，我们只要回答出如何让多个Kafka消费者同时消费相同Topic下的相同Partition的数据就可以了。")]),t._v(" "),a("p",[t._v("为了能够回答好这个问题，我们需要理解Kafka中的一个概念，就是 "),a("strong",[t._v("消费者组")]),t._v("（Consumer Group）。消费者组是Kafka实现单播和广播两种消息模型的基础和手段。")]),t._v(" "),a("p",[t._v("对于同一个Topic（主题）来说，每个消费者组都可以拿到这个Topic中的全部数据。消费者组内的所有消费者协调在一起来订阅并消费Kafka Topic中的所有分区。这里，每个分区只能由同一个消费者组内的一个消费者来消费。")]),t._v(" "),a("p",[t._v("这里，为了更好的理解，我们简单的画一张Kafka消费消息的原理图，如下所示。")]),t._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"图片","data-src":"https://img-blog.csdnimg.cn/img_convert/a95df89030cacb0132afd0a929ea84f1.png",loading:"lazy"}})]),t._v(" "),a("p",[t._v("在这张图中，一个主题可以配置几个分区，生产者发送的消息分发到不同的分区中，消费者接收数据的时候是按照消费者组来接收的，Kafka确保每个分区的消息只能被同一个消费者组中的同一个消费者消费。")]),t._v(" "),a("p",[t._v("如果想要重复消费，那么需要其他的消费者组来消费。Zookeerper中保存每个主题下的每个分区在每个消费者组中消费的offset。")]),t._v(" "),a("p",[t._v("新版kafka把这个offset保存到了一个"),a("code",[t._v("__consumer_offsert")]),t._v("的主题下。 这个"),a("code",[t._v("__consumer_offsert")]),t._v("有50个分区，通过将消费者组的id哈希值%50的值来确定要保存到那一个分区。这样也是为了考虑到Zookeeper不擅长大量数据读写的原因。")]),t._v(" "),a("p",[t._v("所以，如果要一个消费者组用几个消费者来同时消费Kafka中消息的话，可以使用多线程来读取消息，一个线程相当于一个消费者实例。当消费者的数量大于分区的数量时，有些消费者线程会读取不到数据。")]),t._v(" "),a("h2",{attrs:{id:"扩展知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩展知识"}},[t._v("#")]),t._v(" 扩展知识")]),t._v(" "),a("p",[t._v("这里，我们举一个例子：假设一个主题 testTopic 被groupA消费了，现在启动另外一个新的groupB来消费testTopic，默认testTopic-groupB的Offset不是0，而是在Kafka中还没有建立这样的一个Offset。")]),t._v(" "),a("p",[t._v("除非当testTopic 主题有数据的时候，groupB会收到该数据，该条数据也是第一条数据，此时，groupB的Offset并不是从0开始的，而是从刚初始化的Offset开始的, 除非显式的用–from-beginning 来获取从0开始的数据。")]),t._v(" "),a("h2",{attrs:{id:"题目解答"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#题目解答"}},[t._v("#")]),t._v(" 题目解答")]),t._v(" "),a("p",[t._v("多个Kafka消费者要想同时消费相同Topic下的相同Partition的数据，则需要将这些Kafka消费者放到不同的消费者组中。")]),t._v(" "),a("p",[a("strong",[t._v("好了，今天就到这儿吧，我是冰河，我们下期见~~")])]),t._v(" "),a("h2",{attrs:{id:"写在最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#写在最后"}},[t._v("#")]),t._v(" 写在最后")]),t._v(" "),a("p",[a("strong",[t._v("如果你想进大厂，想升职加薪，或者对自己现有的工作比较迷茫，都可以私信我交流，希望我的一些经历能够帮助到大家~~")])]),t._v(" "),a("p",[a("strong",[t._v("好了，今天就到这儿吧，小伙伴们点赞、收藏、评论，一键三连走起呀，我是冰河，我们下期见~~")])]),t._v(" "),a("h2",{attrs:{id:"加群交流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加群交流"}},[t._v("#")]),t._v(" 加群交流")]),t._v(" "),a("p",[t._v("本群的宗旨是给大家提供一个良好的技术学习交流平台，所以杜绝一切广告！由于微信群人满 100 之后无法加入，请扫描下方二维码先添加作者 “冰河” 微信(hacker_binghe)，备注："),a("code",[t._v("学习加群")]),t._v("。")]),t._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/images/personal/hacker_binghe.jpg?raw=true",width:"180px"}}),t._v(" "),a("div",{staticStyle:{"font-size":"18px"}},[t._v("冰河微信")]),t._v(" "),a("br")]),t._v(" "),a("h2",{attrs:{id:"公众号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公众号"}},[t._v("#")]),t._v(" 公众号")]),t._v(" "),a("p",[t._v("分享各种编程语言、开发技术、分布式与微服务架构、分布式数据库、分布式事务、云原生、大数据与云计算技术和渗透技术。另外，还会分享各种面试题和面试技巧。内容在 "),a("strong",[t._v("冰河技术")]),t._v(" 微信公众号首发，强烈建议大家关注。")]),t._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/images/personal/ice_wechat.jpg?raw=true",width:"180px"}}),t._v(" "),a("div",{staticStyle:{"font-size":"18px"}},[t._v("公众号：冰河技术")]),t._v(" "),a("br")]),t._v(" "),a("h2",{attrs:{id:"视频号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视频号"}},[t._v("#")]),t._v(" 视频号")]),t._v(" "),a("p",[t._v("定期分享各种编程语言、开发技术、分布式与微服务架构、分布式数据库、分布式事务、云原生、大数据与云计算技术和渗透技术。另外，还会分享各种面试题和面试技巧。")]),t._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/images/personal/ice_video.png?raw=true",width:"180px"}}),t._v(" "),a("div",{staticStyle:{"font-size":"18px"}},[t._v("视频号：冰河技术")]),t._v(" "),a("br")]),t._v(" "),a("h2",{attrs:{id:"星球"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#星球"}},[t._v("#")]),t._v(" 星球")]),t._v(" "),a("p",[t._v("加入星球 "),a("strong",[a("a",{attrs:{href:"http://m6z.cn/6aeFbs",target:"_blank",rel:"noopener noreferrer"}},[t._v("冰河技术"),a("OutboundLink")],1)]),t._v("，可以获得本站点所有学习内容的指导与帮助。如果你遇到不能独立解决的问题，也可以添加冰河的微信："),a("strong",[t._v("hacker_binghe")]),t._v("， 我们一起沟通交流。另外，在星球中不只能学到实用的硬核技术，还能学习"),a("strong",[t._v("实战项目")]),t._v("！")]),t._v(" "),a("p",[t._v("关注 "),a("a",{attrs:{href:"https://img-blog.csdnimg.cn/20210426115714643.jpg?raw=true",target:"_blank",rel:"noopener noreferrer"}},[t._v("冰河技术"),a("OutboundLink")],1),t._v("公众号，回复 "),a("code",[t._v("星球")]),t._v(" 可以获取入场优惠券。")]),t._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/images/personal/xingqiu.png?raw=true",width:"180px"}}),t._v(" "),a("div",{staticStyle:{"font-size":"18px"}},[t._v("知识星球：冰河技术")]),t._v(" "),a("br")])])}),[],!1,null,null,null);a.default=e.exports}}]);