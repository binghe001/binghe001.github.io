(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{470:function(n,t,a){"use strict";a.r(t);var s=a(14),e=Object(s.a)({},(function(){var n=this,t=n._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h1",{attrs:{id:"《并发设计模式》第56章-流水线模式-流水线模式在netty中的应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#《并发设计模式》第56章-流水线模式-流水线模式在netty中的应用"}},[n._v("#")]),n._v(" 《并发设计模式》第56章-流水线模式-流水线模式在Netty中的应用")]),n._v(" "),t("p",[n._v("作者：冰河\n"),t("br"),n._v("星球："),t("a",{attrs:{href:"http://m6z.cn/6aeFbs",target:"_blank",rel:"noopener noreferrer"}},[n._v("http://m6z.cn/6aeFbs"),t("OutboundLink")],1),n._v(" "),t("br"),n._v("博客："),t("a",{attrs:{href:"https://binghe.gitcode.host",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://binghe.gitcode.host"),t("OutboundLink")],1),n._v(" "),t("br"),n._v("文章汇总："),t("a",{attrs:{href:"https://binghe.gitcode.host/md/all/all.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://binghe.gitcode.host/md/all/all.html"),t("OutboundLink")],1),n._v(" "),t("br"),n._v("源码获取地址："),t("a",{attrs:{href:"https://t.zsxq.com/0dhvFs5oR",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://t.zsxq.com/0dhvFs5oR"),t("OutboundLink")],1)]),n._v(" "),t("blockquote",[t("p",[n._v("沉淀，成长，突破，帮助他人，成就自我。")])]),n._v(" "),t("ul",[t("li",[n._v("本章难度：★★☆☆☆")]),n._v(" "),t("li",[n._v("本章重点：了解流水线模式的核心原理与使用场景，初步掌握流水线模式的应用场景，掌握流水线模式在Netty中的应用，能够初步结合自身项目实际场景思考如何将流水线模式灵活应用到自身实际项目中。")])]),n._v(" "),t("p",[t("strong",[n._v("大家好，我是冰河~~")])]),n._v(" "),t("p",[n._v("在Netty框架的设计中，使用了流水线模式，可以这么说，Netty中的ChannelPipeline是流水线模式的典型应用。小伙伴们彻底搞懂了Netty中的ChannelPipeline机制，Netty也就掌握一大半了。")]),n._v(" "),t("h2",{attrs:{id:"一、channelpipeline的内部结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、channelpipeline的内部结构"}},[n._v("#")]),n._v(" 一、ChannelPipeline的内部结构")]),n._v(" "),t("p",[n._v("ChannelPipeline主要是基于流水线模式实现的一个Netty的的编排组件，负责调度Netty中的各种ChannelHandler，对数据的实际处理还是由ChannelHandler完成。ChannelPipeline内部通过双向链表将不同的ChannelHandler整合在一起，如果有Channel请求到来，ChannelPipeline会依次调用链表中的ChannelHandler来处理数据。如图56-1所示。")]),n._v(" "),t("div",{attrs:{align:"center"}},[t("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/concurrent/2023-11-12-001.png?raw=true",width:"80%"}}),n._v(" "),t("br")]),n._v(" "),t("p",[n._v("可以看到，每个Channel会绑定一个ChannelPipeline，每个ChannelPipeline内部会有多个ChannelHandlerContext，所有的ChannelHandlerContext会由一个链表进行连接。")]),n._v(" "),t("p",[n._v("根据数据在Netty中的流向，ChannelPipeline会分为入站ChannelInboundHandler和出站 ChannelOutboundHandler两种处理器。如果数据是由客户端向服务端发送，就叫做出站，如果是由服务端向客户端发送数据，就叫做入站。入站操作是由InboundHandler处理，而出站操作是由OutboundHandler处理。并且入站是需要经过Decoder解码器处理，而出站是由Encoder编码器处理。")]),n._v(" "),t("p",[n._v("HeadContext 既是 Inbound 处理器，也是 Outbound 处理器。它分别实现了 ChannelInboundHandler和ChannelOutboundHandler，整个写数据的入口就是由HeadContext完成的，HeadContext是ChannelInboundHandler调用链的第一步，也是ChannelOutboundHandler调用链的最后一步，当HeadContext接收到数据后，经过ChannelPipeline中各个ChannelHandler的处理后，最终又会由HeadContext向外写数据。")]),n._v(" "),t("p",[n._v("TailContext 只实现了ChannelInboundHandler 接口，它是ChannelInboundHandler调用链的最后异步，会终止InboundHandler的事件，并且TailContext 是ChannelOutboundHandler调用链的第一步，会将事件传递给上一个节点。")]),n._v(" "),t("h2",{attrs:{id:"二、事件传播机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、事件传播机制"}},[n._v("#")]),n._v(" 二、事件传播机制")]),n._v(" "),t("p",[n._v("Netty的ChannelPipeline中包含的处理器可以分为ChannelInboundHandler入站处理器和ChannelOutboundHandler出站处理器。对应的时间也会分成入站（Inbound）事件和出站（Outbound）事件。")]),n._v(" "),t("p",[n._v("这里，我们写几个基于Netty的代码片段来介绍Netty的事件传播机制。")]),n._v(" "),t("ul",[t("li",[n._v("入站（Inbound）事件示例")])]),n._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("public")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("class")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("InBoundHandlerExample")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("extends")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("ChannelInboundHandlerAdapter")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("private")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("final")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("String")]),n._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("private")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("final")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("boolean")]),n._v(" flush"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("public")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("InBoundHandlerExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("String")]),n._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("boolean")]),n._v(" flush"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("flush "),t("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" flush"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[n._v("@Override")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("public")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("void")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("channelRead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("ChannelHandlerContext")]),n._v(" ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("Object")]),n._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("throws")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("Exception")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("if")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("flush"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n            ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("channel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("writeAndFlush")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("else")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("channelRead")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br")])]),t("ul",[t("li",[n._v("出站（Outbound）事件示例")])]),n._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("public")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("class")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("OutBoundHandlerExample")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("extends")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("ChannelOutboundHandlerAdapter")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("private")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("final")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("String")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("public")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("OutBoundHandlerExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("String")]),n._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),n._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[n._v("@Override")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("public")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("void")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("ChannelHandlerContext")]),n._v(" ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("Object")]),n._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("ChannelPromise")]),n._v(" promise"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("throws")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("Exception")]),n._v(" \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("super")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" promise"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br")])]),t("ul",[t("li",[n._v("整合pipeline示例")])]),n._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[n._v("serverBootstrap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("childHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("new")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("ChannelInitializer")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("SocketChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[n._v("@Override")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("public")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("void")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("initChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("SocketChannel")]),n._v(" ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n        ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("pipeline")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("addLast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("new")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("InBoundHandlerExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[n._v('"InBoundHandlerA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[n._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("addLast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("new")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("InBoundHandlerExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[n._v('"InBoundHandlerB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[n._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("addLast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("new")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("InBoundHandlerExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[n._v('"InBoundHandlerC"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[n._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n        ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("pipeline")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("addLast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("new")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("OutBoundHandlerExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[n._v('"OutBoundHandlerA"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("addLast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("new")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("OutBoundHandlerExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[n._v('"OutBoundHandlerB"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("addLast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("new")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[n._v("OutBoundHandlerExample")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[n._v('"OutBoundHandlerC"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(";")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br")])]),t("p",[n._v("相信这些代码小伙伴们都能看懂，那我们就基于这些代码介绍下Netty的事件传播机制。")]),n._v(" "),t("p",[n._v("在上述代码片段中，我们通过Netty的pipeline的addLast()方法分别添加了三个ChannelInboundHandler处理器和三个ChannelOutboundHandler处理器，添加后的事件处理器在ChannelPipeline内的结构如图56-2所示。")]),n._v(" "),t("div",{attrs:{align:"center"}},[t("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/concurrent/2023-11-12-002.png?raw=true",width:"80%"}}),n._v(" "),t("br")]),n._v(" "),t("p",[n._v("可以看到，当客户端向服务端发送请求时，就会触发InBoundHandlerExample中的channelRead()事件，当InBoundHandlerExample处理完后，在InBoundHandlerC中会调用writeAndFlush()方法向客户端写数据，此时就会触发OutBoundHandlerExample的write()事件。")]),n._v(" "),t("p",[n._v("并且在Netty中，Inbound事件和 Outbound事件的传播方向是不一样的。Inbound事件是由Head向Tail传播，而Outbound事件是由Tail向Head传播。")]),n._v(" "),t("h2",{attrs:{id:"三、异常传播机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、异常传播机制"}},[n._v("#")]),n._v(" 三、异常传播机制")]),n._v(" "),t("h2",{attrs:{id:"查看全文"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看全文"}},[n._v("#")]),n._v(" 查看全文")]),n._v(" "),t("p",[n._v("加入"),t("a",{attrs:{href:"http://m6z.cn/6aeFbs",target:"_blank",rel:"noopener noreferrer"}},[n._v("冰河技术"),t("OutboundLink")],1),n._v("知识星球，解锁完整技术文章与完整代码")])])}),[],!1,null,null,null);t.default=e.exports}}]);