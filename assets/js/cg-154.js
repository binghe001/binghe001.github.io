(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{457:function(s,t,a){"use strict";a.r(t);var n=a(8),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"doris使用及优化-1-2-6-2-0-2-release"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#doris使用及优化-1-2-6-2-0-2-release"}},[s._v("#")]),s._v(" Doris使用及优化（1.2.6 - 2.0.2 release）")]),s._v(" "),t("p",[s._v("文章内容是在使用Doris的过程中逐渐积累，但也只是针对使用的经验，请大家参照的时候要综合考虑自己方使用的情况而定。")]),s._v(" "),t("p",[s._v("官方有很多使用及优化的方式方法，建议小伙伴们把官方文档多读几遍，doris官方文档写的相当不错！")]),s._v(" "),t("p",[s._v("官方文档："),t("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/get-starting/what-is-apache-doris",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://doris.apache.org/zh-CN/docs/get-starting/what-is-apache-doris"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("该文档会在后续的使用过程中，不断更新。")]),s._v(" "),t("p",[t("strong",[s._v("1.缓存优化，对于T+1类型的数据，有很好的查询效率提升")])]),s._v(" "),t("p",[s._v("增加set [global] enable_sql_cache=true;在FE节点上，可以开启SQL缓存，提升查询效率\n增加set [global] enable_partition_cache=true; 在FE节点上，可以开启分区缓存，提升查询效率")]),s._v(" "),t("p",[t("strong",[s._v("2.用with定义临时表，通过select查询with临时表的数据，不能得到预期的正确计算结果")])]),s._v(" "),t("p",[s._v("在be节点增加 enable_low_cardinality_optimize=false;配置，并重启be。")]),s._v(" "),t("p",[t("strong",[s._v("3.当升级doris时fe日志循环出现以下内容:")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("-04-25 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":42:48,217 INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UNKNOWN192168.16 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9010")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1651040787813")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Env.waitForReady"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":896"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v(" catalo \ng to be ready. FE type: UNKNOWN. is ready: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" counter: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1701")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("-04-25 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":42:50,223 INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UNKNOWN "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192168.1644")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9010")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1651040787813")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("「Env.waitForReady"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":896l "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v(" catalo\ng to be ready. FE type: UNKNOWN. is ready: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" counter:1721 \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v("-04-25 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":42:52,230 INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UNKNOWN192168.16 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9010")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1651040787813")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Env.waitForReady"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":896"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v(" catalo \ng to be ready. FE type: UNKNOWN. is ready: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" counter: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1741")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("在 master fe.conf 添加配置：metadata_failure_recovery=true，然后重启，正常之后，关闭这个再重新启动。")]),s._v(" "),t("p",[t("strong",[s._v("4.关于Doris中使用Catalog进行insert into select进行数据导入动作时，语句中带有with子查询的正确使用姿势")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v("\ntest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("description1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attention"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" temp1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'李四测试3'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("attention"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t temp2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'张三测试1'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("attention"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" attention "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" temp1\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNION")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" attention "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" temp2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("5.Doris中通过Catalog insert to hana需要注意的是")])]),s._v(" "),t("p",[s._v("速度太慢，经测试5分钟插入20000条左右数据，各位换其他方式吧。不过Doris在2.0以后的版本已经解决。")]),s._v(" "),t("p",[s._v("【Doris在2.0之后的版本有提升，可以使用2.0之后的版本提升Doris insert hana的速率】")]),s._v(" "),t("blockquote",[t("p",[s._v("2.0.2版本之后，Doris to Hana已经有了很好的提升，效率还不错。上面这个不再是问题。")])]),s._v(" "),t("p",[t("strong",[s._v("6.Doris从1.2.2之后支持自动分桶")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/table-design/data-partition/#%E8%87%AA%E5%8A%A8%E5%88%86%E6%A1%B6",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://doris.apache.org/zh-CN/docs/table-design/data-partition/#%E8%87%AA%E5%8A%A8%E5%88%86%E6%A1%B6"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("strong",[s._v("7.要删除一个带有分区的表数据时，直接使用delete from不能删除")])]),s._v(" "),t("p",[s._v("可以在执行delete前，先执行set delete_without_partition = true;，或者在删除数据时，指定数据所在分区")]),s._v(" "),t("p",[t("strong",[s._v("8.Catalog的JDBC总断开连接，怎么办")]),s._v("\n请在"),t("code",[s._v("jdbc_url")]),s._v("后面加上"),t("code",[s._v("reconnect=true")]),s._v("吧。我建议能加的都加一下，并且源头库的类似超时设置搞的长一点。")]),s._v(" "),t("p",[t("strong",[s._v("9.varchar 类型数据导入时，当数据长度超出预期，会导致丢数据")])]),s._v(" "),t("p",[s._v("调整varchar 规定长度至正常的百分之20~30，或者采用string类型（如果是key不能使用string类型）")]),s._v(" "),t("p",[t("strong",[s._v("10.doris 产生了异常的tablet")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正常来讲，如果doris没有写入数据，下面两条语句查不出东西")]),s._v("\nSHOW PROC "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/cluster_balance/pending_tablets'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \nSHOW PROC "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/cluster_balance/running_tablets'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看数据库tabelt的状态")]),s._v("\nSHOW PROC "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/cluster_health/tablet_health'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n可以看到不健康副本有五个\n----\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10405")]),s._v("   default_cluster:dim "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n----\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定DbId的不健康的tablet")]),s._v("\nSHOW PROC "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/cluster_health/tablet_health/2116843'")]),s._v("\n----\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2279433,2279437")]),s._v("\n----\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以查看tablet属于哪张表")]),s._v("\nSHOW TABLET "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2279437")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看表（分区）级别状态的tablet信息")]),s._v("\nADMIN SHOW REPLICA STATUS FROM stat_users_count dxuc\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果上面那个表报错")]),s._v("\n----\nSQL 错误 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S1000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n----\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果上面的SQL中的表还能打开，创建新表迁移数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所以我认为，简单粗暴的方式修复不健康tablet，直接重做表比较好")]),s._v("\nuse ods_xmcx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ncreate table bike1 as "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from bike"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndrop table bike"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nALTER TABLE bike1 RENAME bike"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nTRUNCATE TABLE orders"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对于大表来说转表比较慢，也可以用这个方法，干掉不健康tablet")]),s._v("\nADMIN SET REPLICA STATUS PROPERTIES"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tablet_id"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10001"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"backend_id"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20001"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bad"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[t("strong",[s._v('11.可以通过在建表时加上"light_schema_change"="true" ，以支持动态修改列，而且速度很快。')])]),s._v(" "),t("p",[t("strong",[s._v("12.对于有字段为NULL的计算，向量化引擎支持不好，建议在表中插入数据时不要有NULL出现，以最大程度使用向量化引擎优势。")])]),s._v(" "),t("p",[t("strong",[s._v("13.因查询过大导致了be宕机")])]),s._v(" "),t("p",[s._v("通过设置加大单查询的使用内存，基本可以解决。例如设置成8GB，SET exec_mem_limit = 8589934592;\n如果有OOM出现，需要分析BE OOM的原因。")]),s._v(" "),t("p",[s._v("分析BE OOM的原因可以参考："),t("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/admin-manual/memory-management/be-oom-analysis",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://doris.apache.org/zh-CN/docs/admin-manual/memory-management/be-oom-analysis"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("strong",[s._v("14.关于使用Catalog写入数据至Doris的事务问题")])]),s._v(" "),t("p",[s._v("Doris的数据是由一组batch的方式写入外部表的，如果中途导入中断，之前写入数据可能需要回滚。所以JDBC外表支持数据写入时的事务，事务的支持需要通过设置session variable: enable_odbc_transcation 。")]),s._v(" "),t("p",[s._v("set enable_odbc_transcation = true;")]),s._v(" "),t("p",[s._v("事务保证了JDBC外表数据写入的原子性，但是一定程度上会降低数据写入的性能，可以考虑酌情开启该功能。")]),s._v(" "),t("p",[t("strong",[s._v("15.如果需要看Doris每次执行的sql，可以打开审计日志功能")])]),s._v(" "),t("p",[s._v("Doris审计日志："),t("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/admin-manual/audit-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://doris.apache.org/zh-CN/docs/admin-manual/audit-plugin"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("对于后面结合doris元数据实现血缘分析很有作用。")]),s._v(" "),t("p",[s._v("注意：审计表的stmt字段是STRING类型，但SQL过长，只能记录4096个长度。\n如果需要完整记录SQL，设置 fe/plugins/AuditLoader/plugin.conf 中的 max_stmt_length=100000")]),s._v(" "),t("p",[t("strong",[s._v("16.关于 routine load")])]),s._v(" "),t("p",[s._v("每次重启doris时，先暂停routine load，doirs启动后，在重启routine load。")]),s._v(" "),t("p",[t("strong",[s._v("17.如果出现timeout when waiting for send execution start RPC. Wait(sec): 5")])]),s._v(" "),t("p",[s._v("尝试设置以下内容，并重启fe和be：")]),s._v(" "),t("p",[s._v("be.conf:")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("fragment_pool_thread_num_max")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("2048")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("fragment_pool_queue_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("4096")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brpc_num_threads")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("256")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("fe.conf")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("remote_fragment_exec_timeout_ms")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("10000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("18.doris fe或be 总掉线")])]),s._v(" "),t("p",[s._v("建议给Doris做服务自动拉起。一旦进程挂了，自动把doris拉起来。")]),s._v(" "),t("p",[s._v("Doris服务自动拉起参见："),t("a",{attrs:{href:"https://doris.apache.org/zh-CN/docs/dev/admin-manual/maint-monitor/automatic-service-start",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://doris.apache.org/zh-CN/docs/dev/admin-manual/maint-monitor/automatic-service-start"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("strong",[s._v("19.最大文件句柄数限制")])]),s._v(" "),t("p",[s._v("BE 启动脚本会检查系统的最大文件句柄数需大于等于 65536，否则启动失败。")]),s._v(" "),t("p",[s._v("检查ulimit，服务器执行：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@DORIS-BE-PRD1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ulimit -n")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("如果小于65536，修改limit：")]),s._v(" "),t("p",[s._v("两种方式：")]),s._v(" "),t("p",[s._v("（1）临时生效，重启服务器失效")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@DORIS-BE-PRD1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ulimit -n 65536")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("（2）永久生效，需要重启服务器")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@DORIS-BE-PRD1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/security/limits.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在文件末尾添加")]),s._v("\n* soft nofile "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n* hard nofile "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@DORIS-BE-PRD1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/sysctl.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在文件末尾添加")]),s._v("\nfs.file-max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使立即生效")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@DORIS-BE-PRD1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /sbin/sysctl -p")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否设置成功")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@DORIS-BE-PRD1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /proc/sys/fs/file-max")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[t("strong",[s._v("20.Doris 高频导入大量数据出现 -238 报错")])]),s._v(" "),t("p",[s._v("尝试在BE上设置这两个参数")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enable_segcompaction")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("compaction_task_num_per_fast_disk")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("22.解决doris会话满导致整个集群查询时间非常长的问题")])]),s._v(" "),t("p",[s._v("通过show processlist;查询FE状态是sleep的会话数一直在增加，导致fe的查询变得很慢，普通查询10s+出结果。")]),s._v(" "),t("p",[s._v("通过两种方式解决：")]),s._v(" "),t("p",[s._v("（1）增加fe的数量，原来是1台fe，增加两台fe observer，分散查询压力\n（2）调整闲时会话释放的时间，默认是1800s，改成300s。")])])}),[],!1,null,null,null);t.default=e.exports}}]);