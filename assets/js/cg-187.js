(window.webpackJsonp=window.webpackJsonp||[]).push([[187],{526:function(s,a,t){"use strict";t.r(a);var n=t(15),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_6款jvm神级工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6款jvm神级工具"}},[s._v("#")]),s._v(" 6款JVM神级工具！！")]),s._v(" "),a("p",[a("strong",[s._v("大家好，我是冰河~~")])]),s._v(" "),a("p",[s._v("你可能一开始会比较畏惧使用复杂的工具去排查问题，又或者是打开了工具感觉无从下手，但是随着实践越来越多，对 Java 程序和各种框架的运作越来越熟悉，你会发现使用这些工具越来越顺手。")]),s._v(" "),a("p",[s._v("这篇文章中介绍下如何使用 "),a("strong",[s._v("JDK")]),s._v(" 自带工具来分析和定位 Java 程序的问题。")]),s._v(" "),a("h2",{attrs:{id:"使用-jdk-自带工具查看-jvm-情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-jdk-自带工具查看-jvm-情况"}},[s._v("#")]),s._v(" 使用 JDK 自带工具查看 JVM 情况")]),s._v(" "),a("p",[s._v("JDK 自带了很多命令行甚至是图形界面工具，帮助我们查看 JVM 的一些信息。比如，在我的机器上运行 "),a("strong",[s._v("ls")]),s._v(" 命令，可以看到 JDK 8 提供了非常多的工具或程序：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/jvm/2025-05-25-001.png?raw=true",width:"80%"}}),s._v(" "),a("br")]),s._v(" "),a("p",[s._v("接下来，我会与你介绍些常用的监控工具。你也可以先通过下面这张图了解下各种工具的基本作用：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/jvm/2025-05-25-002.png?raw=true",width:"80%"}}),s._v(" "),a("br")]),s._v(" "),a("p",[s._v("为了测试这些工具，我们先来写一段代码：启动 10 个死循环的线程，每个线程分配一个 10MB 左右的字符串，然后休眠 10 秒。可以想象到，这个程序会对 GC 造成压力：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("//启动10个线程\nIntStream.rangeClosed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".mapToObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" new Thread"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" {\n    while "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" {\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("每一个线程都是一个死循环，休眠"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("秒，打印"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("M数据\n        String payload "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" IntStream.rangeClosed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                .mapToObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(' "a"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                .collect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Collectors.joining"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v('""'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v(" + UUID.randomUUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".toString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        try "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            TimeUnit."),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("SECONDS")]),s._v(".sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" catch "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("InterruptedException e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            e.printStackTrace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        System.out.println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("payload.length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(".forEach"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Thread::start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\nTimeUnit.HOURS.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("修改 pom.xml，配置 spring-boot-maven-plugin 插件打包的 Java 程序的 main 方法类：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("spring-boot-maven-plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("configuration"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("mainClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("org.geekbang.time.commonmistakes.troubleshootingtools.jdktool.CommonMistakesApplication\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/mainClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/configuration"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("然后使用 java -jar 启动进程，设置 JVM 参数，让堆最小最大都是 1GB：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" common-mistakes-0.0.1-SNAPSHOT.jar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xms1g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx1g")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("完成这些准备工作后，我们就可以使用 JDK 提供的工具，来观察分析这个测试程序了。")]),s._v(" "),a("h2",{attrs:{id:"jps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jps"}},[s._v("#")]),s._v(" jps")]),s._v(" "),a("p",[s._v("首先，使用 jps 得到 Java 进程列表，这会比使用 ps 来的方便：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("➜  ~ jps\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12707")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22261")]),s._v(" Launcher\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23864")]),s._v(" common-mistakes-0.0.1-SNAPSHOT.jar\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15608")]),s._v(" RemoteMavenServer36\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23243")]),s._v(" Main\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23868")]),s._v(" Jps\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22893")]),s._v(" KotlinCompileDaemon\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"jinfo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jinfo"}},[s._v("#")]),s._v(" jinfo")]),s._v(" "),a("p",[s._v("然后，可以使用 jinfo 打印 JVM 的各种参数：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("➜  ~ jinfo "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23864")]),s._v("\nJava System Properties:\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Wed Jan 29 12:49:47 CST 2020")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user.name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("zhuye\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path.separator")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("os.version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.15")]),s._v(".2\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("java.runtime.name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" SE Runtime Environment\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("file.encoding")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("UTF-8\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("java.vm.name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Java HotSpot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n\nVM Flags:\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:CICompilerCount")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:ConcGCThreads")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:G1ConcRefinementThreads")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:G1HeapRegionSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048576")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:GCDrainStackTargetSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:InitialHeapSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("268435456")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:MarkStackSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4194304")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:MaxHeapSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967296")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:MaxNewSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2576351232")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:MinHeapDeltaBytes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048576")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:NonNMethodCodeHeapSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5835340")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:NonProfiledCodeHeapSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("122911450")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:ProfiledCodeHeapSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("122911450")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:ReservedCodeCacheSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("251658240")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:+SegmentedCodeCache")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:+UseCompressedClassPointers")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:+UseCompressedOops")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:+UseG1GC")]),s._v("\n\n\nVM Arguments:\njava_command: common-mistakes-0.0.1-SNAPSHOT.jar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xms1g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx1g")]),s._v("\njava_class_path "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": common-mistakes-0.0.1-SNAPSHOT.jar\nLauncher Type: SUN_STANDARD\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("查看第 15 行和 19 行可以发现，"),a("strong",[s._v("我们设置 JVM 参数的方式不对，-Xms1g 和 -Xmx1g 这两个参数被当成了 Java 程序的启动参数")]),s._v("，整个 JVM 目前最大内存是 4GB 左右，而不是 1GB。")]),s._v(" "),a("p",[s._v("因此，当我们怀疑 JVM 的配置很不正常的时候，要第一时间使用工具来确认参数。除了使用工具确认 JVM 参数外，你也可以打印 VM 参数和程序参数：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("System.out.println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VM options"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nSystem.out.println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ManagementFactory.getRuntimeMXBean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".getInputArguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".collect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Collectors.joining"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("System.lineSeparator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nSystem.out.println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Program arguments"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nSystem.out.println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Arrays.stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".collect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Collectors.joining"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("System.lineSeparator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("把 JVM 参数放到 -jar 之前，重新启动程序，可以看到如下输出，从输出也可以确认这次 JVM 参数的配置正确了：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("➜  target git:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ✗ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xms1g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx1g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" common-mistakes-0.0.1-SNAPSHOT.jar "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\nVM options\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xms1g")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx1g")]),s._v("\nProgram arguments\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"jvisualvm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jvisualvm"}},[s._v("#")]),s._v(" jvisualvm")]),s._v(" "),a("p",[s._v("然后，启动另一个重量级工具 jvisualvm 观察一下程序，可以在概述面板再次确认 JVM 参数设置成功了：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/jvm/2025-05-25-003.png?raw=true",width:"80%"}}),s._v(" "),a("br")]),s._v(" "),a("p",[s._v("继续观察监视面板可以看到，JVM 的 GC 活动基本是 10 秒发生一次，堆内存在 250MB 到 900MB 之间波动，活动线程数是 22。我们可以在监视面板看到 JVM 的基本情况，也可以直接在这里进行手动 GC 和堆 Dump 操作：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/jvm/2025-05-25-004.png?raw=true",width:"80%"}}),s._v(" "),a("br")]),s._v(" "),a("p",[s._v("jconsole如果希望看到各个内存区的 GC 曲线图，可以使用 jconsole 观察。jconsole 也是一个综合性图形界面监控工具，比 jvisualvm 更方便的一点是，可以用曲线的形式监控各种数据，包括 MBean 中的属性值：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/jvm/2025-05-25-005.png?raw=true",width:"80%"}}),s._v(" "),a("br")]),s._v(" "),a("h2",{attrs:{id:"jstat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jstat"}},[s._v("#")]),s._v(" jstat")]),s._v(" "),a("p",[s._v("同样，如果没有条件使用图形界面（毕竟在 Linux 服务器上，我们主要使用命令行工具），又希望看到 GC 趋势的话，我们可以使用 jstat 工具。")]),s._v(" "),a("p",[s._v("jstat 工具允许以固定的监控频次输出 JVM 的各种监控指标，比如使用 -gcutil 输出 GC 和内存占用汇总信息，每隔 5 秒输出一次，输出 100 次，可以看到 Young GC 比较频繁，而 Full GC 基本 10 秒一次：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("➜  ~ jstat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-gcutil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23940")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.36")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("87.63")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.30")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.06")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("539")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.021")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.972")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("837")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.976")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.968")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.60")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("69.51")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.30")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.06")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("540")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.029")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.972")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("839")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.978")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.979")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.50")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.81")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.27")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.03")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("548")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.143")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.002")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("840")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.981")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.126")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.59")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70.47")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.27")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.03")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("549")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.177")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.002")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("844")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.985")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.164")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.57")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.85")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.32")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.09")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("550")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.204")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.002")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("845")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.990")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.196")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.65")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77.69")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.32")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.09")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("559")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.469")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.198")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("847")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.993")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.659")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.65")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77.69")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.32")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.09")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("559")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.469")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.198")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("847")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.993")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.659")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.70")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35.54")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.32")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.09")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("567")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.763")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.378")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("853")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.001")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.142")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.70")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41.22")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.32")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.09")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("567")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.763")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.378")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("853")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.001")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.142")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.89")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96.76")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.32")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.09")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("574")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.943")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.487")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("859")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.007")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.438")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.39")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.20")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94.32")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.09")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("575")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.946")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.487")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("861")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.010")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.442")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("blockquote",[a("p",[s._v("其中，S0 表示 Survivor0 区占用百分比，S1 表示 Survivor1 区占用百分比，E 表示 Eden 区占用百分比，O  表示老年代占用百分比，M 表示元数据区占用百分比，YGC 表示年轻代回收次数，YGCT 表示年轻代回收耗时，FGC 表示老年代回收次数，FGCT 表示老年代回收耗时。")])]),s._v(" "),a("p",[s._v("jstat 命令的参数众多，包含 -class、-compiler、-gc 等。Java 8、Linux/Unix 平台 jstat 工具的完整介绍，你可以查看这里。jstat 定时输出的特性，可以方便我们持续观察程序的各项指标。")]),s._v(" "),a("p",[s._v("继续来到线程面板可以看到，大量以 Thread 开头的线程基本都是有节奏的 10 秒运行一下，其他时间都在休眠，和我们的代码逻辑匹配：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/jvm/2025-05-25-006.png?raw=true",width:"80%"}}),s._v(" "),a("br")]),s._v(" "),a("p",[s._v("点击面板的线程 Dump 按钮，可以查看线程瞬时的线程栈：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/jvm/2025-05-25-007.png?raw=true",width:"80%"}}),s._v(" "),a("br")]),s._v(" "),a("h2",{attrs:{id:"jstack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jstack"}},[s._v("#")]),s._v(" jstack")]),s._v(" "),a("p",[s._v("通过命令行工具 jstack，也可以实现抓取线程栈的操作：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("➜  ~ jstack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23940")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-01-29 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":08:15\nFull thread dump Java HotSpot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.0")]),s._v(".3+12-LTS mixed mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1 prio=5 os_prio=31 cpu=440.66ms elapsed=574.86s tid=0x00007ffdd9800000 nid=0x2803 waiting on condition  [0x0000700003849000]")]),s._v("\n   java.lang.Thread.State: TIMED_WAITING "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sleeping"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at java.lang.Thread.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/Native Method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at java.lang.Thread.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/Thread.java:339"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at java.util.concurrent.TimeUnit.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/TimeUnit.java:446"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at org.geekbang.time.commonmistakes.troubleshootingtools.jdktool.CommonMistakesApplication.main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CommonMistakesApplication.java:41"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/Native Method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at jdk.internal.reflect.NativeMethodAccessorImpl.invoke"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/NativeMethodAccessorImpl.java:62"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/DelegatingMethodAccessorImpl.java:43"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at java.lang.reflect.Method.invoke"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/Method.java:566"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at org.springframework.boot.loader.MainMethodRunner.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MainMethodRunner.java:48"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at org.springframework.boot.loader.Launcher.launch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Launcher.java:87"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at org.springframework.boot.loader.Launcher.launch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Launcher.java:51"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at org.springframework.boot.loader.JarLauncher.main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("JarLauncher.java:52"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#13 prio=5 os_prio=31 cpu=17851.77ms elapsed=574.41s tid=0x00007ffdda029000 nid=0x9803 waiting on condition  [0x000070000539d000]")]),s._v("\n   java.lang.Thread.State: TIMED_WAITING "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sleeping"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at java.lang.Thread.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/Native Method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at java.lang.Thread.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/Thread.java:339"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at java.util.concurrent.TimeUnit.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/TimeUnit.java:446"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at org.geekbang.time.commonmistakes.troubleshootingtools.jdktool.CommonMistakesApplication.lambda"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$null")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CommonMistakesApplication.java:33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at org.geekbang.time.commonmistakes.troubleshootingtools.jdktool.CommonMistakesApplication"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("Lambda"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$41")]),s._v("/0x00000008000a8c40.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown Source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  at java.lang.Thread.run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11.0.3/Thread.java:834"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("抓取后可以使用类似"),a("strong",[s._v("fastthread")]),s._v("（https://fastthread.io/）这样的在线分析工具来分析线程栈。")]),s._v(" "),a("h2",{attrs:{id:"jcmd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jcmd"}},[s._v("#")]),s._v(" jcmd")]),s._v(" "),a("p",[s._v("最后，我们来看一下 Java HotSpot 虚拟机的 NMT 功能。")]),s._v(" "),a("p",[s._v("通过 NMT，我们可以观察细粒度内存使用情况，设置 -XX:NativeMemoryTracking=summary/detail 可以开启 NMT 功能，开启后可以使用 jcmd 工具查看 NMT 数据。")]),s._v(" "),a("p",[s._v("我们重新启动一次程序，这次加上 JVM 参数以 detail 方式开启 NMT：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xms1g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx1g")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:ThreadStackSize")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("256k "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XX:NativeMemoryTracking")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("detail\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在这里，我们还增加了 -XX:ThreadStackSize 参数，并将其值设置为 256k，也就是期望把线程栈设置为 256KB。我们通过 NMT 观察一下设置是否成功。")]),s._v(" "),a("p",[s._v("启动程序后执行如下 jcmd 命令，以概要形式输出 NMT 结果。可以看到，当前有 32 个线程，线程栈总共保留了差不多 4GB 左右的内存。我们明明配置线程栈最大 256KB 啊，为什么会出现 4GB 这么夸张的数字呢，到底哪里出了问题呢？")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("➜  ~ jcmd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24404")]),s._v(" VM.native_memory summary\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24404")]),s._v(":\n\nNative Memory Tracking:\n\nTotal: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reserved")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("6635310KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5337110KB\n-                 Java Heap "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reserved"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1048576KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1048576KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mmap: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reserved")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1048576KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1048576KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n-                     Class "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reserved"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1066233KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("15097KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("classes "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#902)")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("malloc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("9465KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#908)")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mmap: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reserved")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1056768KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5632KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n-                    Thread "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reserved"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4209797KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4209797KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("thread "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#32)")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stack: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reserved")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4209664KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4209664KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("malloc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("96KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#165)")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arena"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("37KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#59)")]),s._v("\n\n\n-                      Code "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reserved"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("249823KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("2759KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("malloc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("223KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#730)")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mmap: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reserved")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("249600KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("2536KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n-                        GC "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reserved"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("48700KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("48700KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("malloc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("10384KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#135)")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mmap: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reserved")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("38316KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("38316KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n-                  Compiler "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reserved"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("186KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("186KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("malloc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("56KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#105)")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arena"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("131KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7)")]),s._v("\n\n\n-                  Internal "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reserved"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("9693KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("9693KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("malloc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("9661KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2585)")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mmap: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reserved")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n-                    Symbol "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reserved"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("2021KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("2021KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("malloc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1182KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#334)")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("arena"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("839KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1)")]),s._v("\n\n\n-    Native Memory Tracking "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reserved"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("85KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("85KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("malloc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5KB "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53)")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tracking "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("overhead")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("80KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n-               Arena Chunk "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reserved"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("196KB, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("committed")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("196KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("malloc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("196KB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("            \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br")])]),a("p",[s._v("重新以 VM.native_memory detail 参数运行 jcmd：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("jcmd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24404")]),s._v(" VM.native_memory detail\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到，"),a("strong",[s._v("有 16 个可疑线程，每一个线程保留了 262144KB 内存，也就是 256MB")]),s._v("（通过下图红框可以看到，使用关键字 262144KB for Thread Stack from 搜索到了 16 个结果）：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/jvm/2025-05-25-008.png?raw=true",width:"80%"}}),s._v(" "),a("br")]),s._v(" "),a("p",[s._v("其实，ThreadStackSize 参数的单位是 KB，所以我们如果要设置线程栈 256KB，那么应该设置 256 而不是 256k。重新设置正确的参数后，使用 jcmd 再次验证下：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/assets/images/core/jvm/2025-05-25-009.png?raw=true",width:"80%"}}),s._v(" "),a("br")]),s._v(" "),a("p",[s._v("除了用于查看 NMT 外，jcmd 还有许多功能。我们可以通过 help，看到它的所有功能：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("jcmd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24781")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("除了 jps、jinfo、jcmd、jstack、jstat、jconsole、jvisualvm 外，JDK 中还有一些工具，你可以通过官方文档查看完整介绍。")]),s._v(" "),a("blockquote",[a("p",[s._v("官方文档：https://docs.oracle.com/javase/8/docs/technotes/tools/")])]),s._v(" "),a("h2",{attrs:{id:"写在最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#写在最后"}},[s._v("#")]),s._v(" 写在最后")]),s._v(" "),a("p",[s._v("在冰河的知识星球有大量从零开始带你手写的企业级生产项目，像DeepSeek大模型、手写高性能熔断组件、手写通用指标上报组件、手写高性能数据库路由组件、分布式IM即时通讯系统、Sekill分布式秒杀系统、手写RPC、简易商城系统等等，这些项目的需求、方案、架构、落地等均来自互联网真实业务场景，让你真正学到互联网大厂的业务与技术落地方案，并将其有效转化为自己的知识储备。")]),s._v(" "),a("p",[a("strong",[s._v("值得一提的是：冰河自研的Polaris高性能网关比某些开源网关项目性能更高，并且冰河也正在为企业级高性能RPC框架录制视频，全程带你分析原理和手撸代码。")]),s._v(" 你还在等啥？不少小伙伴经过星球硬核技术和项目的历练，早已成功跳槽加薪，实现薪资翻倍，而你，还在原地踏步，抱怨大环境不好。抛弃焦虑和抱怨，我们一起塌下心来沉淀硬核技术和项目，让自己的薪资更上一层楼。")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/images/personal/xingqiu_149.png?raw=true",width:"80%"}}),s._v(" "),a("br")]),s._v(" "),a("p",[s._v("目前，领券加入星球就可以跟冰河一起学习《DeepSeek大模型》、《手写高性能通用熔断组件项目》、《手写高性能通用监控指标上报组件》、《手写高性能数据库路由组件项目》、《手写简易商城脚手架项目》、《手写高性能RPC项目》和《Spring6核心技术与源码解析》、《实战高并发设计模式》、《分布式Seckill秒杀系统》、《分布式IM即时通讯系统》和《手写高性能Polaris网关》，从零开始介绍原理、设计架构、手撸代码。")]),s._v(" "),a("p",[a("strong",[s._v("花很少的钱就能学这么多硬核技术、中间件项目和大厂秒杀系统与分布式IM即时通讯系统，比其他培训机构不知便宜多少倍，硬核多少倍，如果是我，我会买他个十年！")])]),s._v(" "),a("p",[s._v("加入要趁早，后续还会随着项目和加入的人数涨价，而且只会涨，不会降，先加入的小伙伴就是赚到。")]),s._v(" "),a("p",[s._v("另外，还有一个限时福利，邀请一个小伙伴加入，冰河就会给一笔 "),a("strong",[s._v("分享有奖")]),s._v(" ，有些小伙伴都邀请了50+人，早就回本了！")]),s._v(" "),a("h2",{attrs:{id:"其他方式加入星球"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他方式加入星球"}},[s._v("#")]),s._v(" 其他方式加入星球")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("链接")]),s._v(" ：打开链接 http://m6z.cn/6aeFbs 加入星球。")]),s._v(" "),a("li",[a("strong",[s._v("回复")]),s._v(" ：在公众号 "),a("strong",[s._v("冰河技术")]),s._v(" 回复 "),a("strong",[s._v("星球")]),s._v(" 领取优惠券加入星球。")])]),s._v(" "),a("p",[a("strong",[s._v("特别提醒：")]),s._v(" 苹果用户进圈或续费，请加微信 "),a("strong",[s._v("hacker_binghe")]),s._v(" 扫二维码，或者去公众号 "),a("strong",[s._v("冰河技术")]),s._v(" 回复 "),a("strong",[s._v("星球")]),s._v(" 扫二维码加入星球。")]),s._v(" "),a("h2",{attrs:{id:"联系冰河"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#联系冰河"}},[s._v("#")]),s._v(" 联系冰河")]),s._v(" "),a("h3",{attrs:{id:"加群交流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加群交流"}},[s._v("#")]),s._v(" 加群交流")]),s._v(" "),a("p",[s._v("本群的宗旨是给大家提供一个良好的技术学习交流平台，所以杜绝一切广告！由于微信群人满 100 之后无法加入，请扫描下方二维码先添加作者 “冰河” 微信(hacker_binghe)，备注："),a("code",[s._v("星球编号")]),s._v("。")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/images/personal/hacker_binghe.jpg?raw=true",width:"180px"}}),s._v(" "),a("div",{staticStyle:{"font-size":"18px"}},[s._v("冰河微信")]),s._v(" "),a("br")]),s._v(" "),a("h3",{attrs:{id:"公众号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#公众号"}},[s._v("#")]),s._v(" 公众号")]),s._v(" "),a("p",[s._v("分享各种编程语言、开发技术、分布式与微服务架构、分布式数据库、分布式事务、云原生、大数据与云计算技术和渗透技术。另外，还会分享各种面试题和面试技巧。内容在 "),a("strong",[s._v("冰河技术")]),s._v(" 微信公众号首发，强烈建议大家关注。")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/images/personal/ice_wechat.jpg?raw=true",width:"180px"}}),s._v(" "),a("div",{staticStyle:{"font-size":"18px"}},[s._v("公众号：冰河技术")]),s._v(" "),a("br")]),s._v(" "),a("h3",{attrs:{id:"视频号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视频号"}},[s._v("#")]),s._v(" 视频号")]),s._v(" "),a("p",[s._v("定期分享各种编程语言、开发技术、分布式与微服务架构、分布式数据库、分布式事务、云原生、大数据与云计算技术和渗透技术。另外，还会分享各种面试题和面试技巧。")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/images/personal/ice_video.png?raw=true",width:"180px"}}),s._v(" "),a("div",{staticStyle:{"font-size":"18px"}},[s._v("视频号：冰河技术")]),s._v(" "),a("br")]),s._v(" "),a("h3",{attrs:{id:"星球"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#星球"}},[s._v("#")]),s._v(" 星球")]),s._v(" "),a("p",[s._v("加入星球 "),a("strong",[a("a",{attrs:{href:"http://m6z.cn/6aeFbs",target:"_blank",rel:"noopener noreferrer"}},[s._v("冰河技术"),a("OutboundLink")],1)]),s._v("，可以获得本站点所有学习内容的指导与帮助。如果你遇到不能独立解决的问题，也可以添加冰河的微信："),a("strong",[s._v("hacker_binghe")]),s._v("， 我们一起沟通交流。另外，在星球中不只能学到实用的硬核技术，还能学习"),a("strong",[s._v("实战项目")]),s._v("！")]),s._v(" "),a("p",[s._v("关注 "),a("a",{attrs:{href:"https://img-blog.csdnimg.cn/20210426115714643.jpg?raw=true",target:"_blank",rel:"noopener noreferrer"}},[s._v("冰河技术"),a("OutboundLink")],1),s._v("公众号，回复 "),a("code",[s._v("星球")]),s._v(" 可以获取入场优惠券。")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://binghe.gitcode.host/images/personal/xingqiu.png?raw=true",width:"180px"}}),s._v(" "),a("div",{staticStyle:{"font-size":"18px"}},[s._v("知识星球：冰河技术")]),s._v(" "),a("br")]),s._v(" "),a("p",[a("strong",[s._v("好了，今天就到这儿吧，我是冰河，我们下期见~~")])])])}),[],!1,null,null,null);a.default=e.exports}}]);